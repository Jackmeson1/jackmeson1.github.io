<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 900 700">
  <defs>
    <linearGradient id="dealerBox" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:#8b5cf6;stop-opacity:0.3"/>
      <stop offset="100%" style="stop-color:#6366f1;stop-opacity:0.2"/>
    </linearGradient>
    <linearGradient id="retailBox" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:#10b981;stop-opacity:0.3"/>
      <stop offset="100%" style="stop-color:#059669;stop-opacity:0.2"/>
    </linearGradient>
    <marker id="arrowBlue" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
      <polygon points="0,0 0,6 10,3" fill="#3b82f6"/>
    </marker>
    <marker id="arrowOrange" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
      <polygon points="0,0 0,6 10,3" fill="#f97316"/>
    </marker>
    <marker id="arrowGreen" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
      <polygon points="0,0 0,6 10,3" fill="#10b981"/>
    </marker>
    <marker id="arrowRed" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
      <polygon points="0,0 0,6 10,3" fill="#ef4444"/>
    </marker>
  </defs>

  <!-- Background -->
  <rect width="900" height="700" fill="#0f1419"/>

  <!-- Title -->
  <text x="450" y="35" fill="#f3f4f6" font-size="24" font-weight="bold" text-anchor="middle">Dealer Hedging Flow Diagram</text>
  <text x="450" y="60" fill="#9ca3af" font-size="13" text-anchor="middle">How Market Makers Create "Walls" Through Delta Hedging</text>

  <!-- Timeline -->
  <line x1="100" y1="100" x2="800" y2="100" stroke="#4b5563" stroke-width="2"/>
  <text x="50" y="105" fill="#9ca3af" font-size="12" text-anchor="middle">Time â†’</text>

  <!-- Step 1: Initial Trade -->
  <g transform="translate(150, 150)">
    <rect x="-80" y="-20" width="160" height="120" fill="url(#retailBox)" stroke="#10b981" stroke-width="2" rx="8"/>
    <text x="0" y="0" fill="#10b981" font-size="14" font-weight="bold" text-anchor="middle">Step 1: You Buy</text>
    <text x="0" y="20" fill="#d1d5db" font-size="11" text-anchor="middle">1,000 Ã— $450 Calls</text>
    <text x="0" y="38" fill="#d1d5db" font-size="11" text-anchor="middle">Premium: $15/share</text>
    <text x="0" y="56" fill="#34d399" font-size="11" text-anchor="middle">TSLA @ $450</text>
    <text x="0" y="74" fill="#6ee7b7" font-size="10" text-anchor="middle" font-style="italic">Delta = 0.50</text>
    <circle cx="0" cy="-35" r="8" fill="#10b981"/>
    <text x="0" y="-30" fill="#0f1419" font-size="10" font-weight="bold" text-anchor="middle">1</text>
  </g>

  <!-- Arrow from Step 1 to Dealer -->
  <path d="M 230,180 L 350,180" stroke="#3b82f6" stroke-width="2" fill="none" marker-end="url(#arrowBlue)"/>
  <text x="290" y="170" fill="#3b82f6" font-size="10" text-anchor="middle">Buy calls</text>

  <!-- Dealer Box (center) -->
  <g transform="translate(450, 180)">
    <rect x="-100" y="-50" width="200" height="140" fill="url(#dealerBox)" stroke="#8b5cf6" stroke-width="3" rx="10"/>
    <text x="0" y="-20" fill="#8b5cf6" font-size="16" font-weight="bold" text-anchor="middle">DEALER</text>
    <text x="0" y="0" fill="#d1d5db" font-size="12" text-anchor="middle">Position:</text>
    <text x="0" y="18" fill="#ef4444" font-size="13" font-weight="bold" text-anchor="middle">Short 1,000 Calls</text>
    <text x="0" y="38" fill="#9ca3af" font-size="11" text-anchor="middle">Delta: -0.50</text>
    <text x="0" y="56" fill="#9ca3af" font-size="11" text-anchor="middle">Shares needed:</text>
    <text x="0" y="72" fill="#a855f7" font-size="12" font-weight="bold" text-anchor="middle">+50,000 to hedge</text>
  </g>

  <!-- Arrow from Dealer to Market (initial hedge) -->
  <path d="M 550,220 L 670,300" stroke="#f97316" stroke-width="2" fill="none" marker-end="url(#arrowOrange)"/>
  <text x="610" y="255" fill="#f97316" font-size="10" text-anchor="middle">Buy 50k shares</text>

  <!-- Market Box (right) -->
  <g transform="translate(750, 330)">
    <rect x="-80" y="-30" width="160" height="100" fill="#1f2937" stroke="#f59e0b" stroke-width="2" rx="8"/>
    <text x="0" y="-5" fill="#f59e0b" font-size="14" font-weight="bold" text-anchor="middle">MARKET</text>
    <text x="0" y="15" fill="#d1d5db" font-size="11" text-anchor="middle">TSLA Stock</text>
    <text x="0" y="33" fill="#fbbf24" font-size="12" text-anchor="middle">Initial: $450</text>
    <text x="0" y="50" fill="#9ca3af" font-size="10" text-anchor="middle" font-style="italic">Dealer buys â†’ price â†‘</text>
  </g>

  <!-- Step 2: Price Rises -->
  <g transform="translate(150, 380)">
    <rect x="-80" y="-20" width="160" height="100" fill="#1f2937" stroke="#10b981" stroke-width="2" rx="8"/>
    <text x="0" y="0" fill="#10b981" font-size="14" font-weight="bold" text-anchor="middle">Step 2: Price Rises</text>
    <text x="0" y="20" fill="#34d399" font-size="13" text-anchor="middle">TSLA â†’ $460</text>
    <text x="0" y="38" fill="#6ee7b7" font-size="11" text-anchor="middle">Call Delta: 0.50 â†’ 0.60</text>
    <text x="0" y="56" fill="#d1d5db" font-size="10" text-anchor="middle" font-style="italic">(Gamma effect)</text>
    <circle cx="0" cy="-35" r="8" fill="#10b981"/>
    <text x="0" y="-30" fill="#0f1419" font-size="10" font-weight="bold" text-anchor="middle">2</text>
  </g>

  <!-- Dealer rehedge box -->
  <g transform="translate(450, 400)">
    <rect x="-100" y="-30" width="200" height="100" fill="url(#dealerBox)" stroke="#8b5cf6" stroke-width="3" rx="10"/>
    <text x="0" y="-5" fill="#8b5cf6" font-size="14" font-weight="bold" text-anchor="middle">Dealer Rehedges</text>
    <text x="0" y="15" fill="#d1d5db" font-size="11" text-anchor="middle">New Delta: -0.60</text>
    <text x="0" y="33" fill="#ef4444" font-size="12" text-anchor="middle">Need 60k shares total</text>
    <text x="0" y="51" fill="#a855f7" font-size="12" font-weight="bold" text-anchor="middle">Buy +10k more</text>
  </g>

  <!-- Arrow showing rehedge -->
  <path d="M 550,430 L 670,430" stroke="#f97316" stroke-width="2" fill="none" marker-end="url(#arrowOrange)"/>
  <text x="610" y="420" fill="#f97316" font-size="10" text-anchor="middle">Buy 10k shares</text>

  <!-- Step 3: Price Falls -->
  <g transform="translate(150, 550)">
    <rect x="-80" y="-20" width="160" height="100" fill="#1f2937" stroke="#ef4444" stroke-width="2" rx="8"/>
    <text x="0" y="0" fill="#ef4444" font-size="14" font-weight="bold" text-anchor="middle">Step 3: Price Falls</text>
    <text x="0" y="20" fill="#fca5a5" font-size="13" text-anchor="middle">TSLA â†’ $445</text>
    <text x="0" y="38" fill="#fecaca" font-size="11" text-anchor="middle">Call Delta: 0.60 â†’ 0.45</text>
    <text x="0" y="56" fill="#d1d5db" font-size="10" text-anchor="middle" font-style="italic">(Gamma effect)</text>
    <circle cx="0" cy="-35" r="8" fill="#ef4444"/>
    <text x="0" y="-30" fill="#0f1419" font-size="10" font-weight="bold" text-anchor="middle">3</text>
  </g>

  <!-- Dealer rehedge box (sell) -->
  <g transform="translate(450, 570)">
    <rect x="-100" y="-30" width="200" height="100" fill="url(#dealerBox)" stroke="#8b5cf6" stroke-width="3" rx="10"/>
    <text x="0" y="-5" fill="#8b5cf6" font-size="14" font-weight="bold" text-anchor="middle">Dealer Rehedges</text>
    <text x="0" y="15" fill="#d1d5db" font-size="11" text-anchor="middle">New Delta: -0.45</text>
    <text x="0" y="33" fill="#10b981" font-size="12" text-anchor="middle">Need only 45k shares</text>
    <text x="0" y="51" fill="#a855f7" font-size="12" font-weight="bold" text-anchor="middle">Sell -15k shares</text>
  </g>

  <!-- Arrow showing sell -->
  <path d="M 550,600 L 670,600" stroke="#ef4444" stroke-width="2" fill="none" marker-end="url(#arrowRed)"/>
  <text x="610" y="590" fill="#ef4444" font-size="10" text-anchor="middle">Sell 15k shares</text>

  <!-- Market impact box -->
  <g transform="translate(750, 520)">
    <rect x="-80" y="-40" width="160" height="140" fill="#1f2937" stroke="#f59e0b" stroke-width="2" rx="8"/>
    <text x="0" y="-15" fill="#f59e0b" font-size="13" font-weight="bold" text-anchor="middle">Market Impact</text>
    <text x="0" y="5" fill="#10b981" font-size="11" text-anchor="middle">â†‘ Price rises</text>
    <text x="0" y="20" fill="#34d399" font-size="10" text-anchor="middle">â†’ Dealers BUY</text>
    <line x1="-60" y1="30" x2="60" y2="30" stroke="#4b5563" stroke-width="1"/>
    <text x="0" y="48" fill="#ef4444" font-size="11" text-anchor="middle">â†“ Price falls</text>
    <text x="0" y="63" fill="#fca5a5" font-size="10" text-anchor="middle">â†’ Dealers SELL</text>
    <text x="0" y="85" fill="#fbbf24" font-size="11" font-weight="bold" text-anchor="middle">= Price Damping</text>
  </g>

  <!-- Key insight box -->
  <rect x="50" y="640" width="800" height="50" fill="#7c3aed" opacity="0.2" stroke="#8b5cf6" stroke-width="2" rx="8"/>
  <text x="450" y="663" fill="#f3f4f6" font-size="13" font-weight="bold" text-anchor="middle">ðŸ’¡ The Counterintuitive Result</text>
  <text x="450" y="682" fill="#e9d5ff" font-size="11" text-anchor="middle">Dealers trade WITH momentum (buy rallies, sell dips) â†’ This STABILIZES price near strike, creating "wall" effect</text>
</svg>
